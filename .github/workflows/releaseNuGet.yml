name: "ðŸš€ publish nuget"

on:
  push:
    branches:
      - main

jobs:
  #build:
  #  name: build and copy npm
  #  runs-on: ubuntu-latest
  #
  #  steps:
  #    - name: checkout
  #      uses: actions/checkout@v2
  #    - name: node
  #      uses: actions/setup-node@v1
  #      with:
  #        node-version: 12
  #        registry-url: https://registry.npmjs.org
  #    - name: Install
  #      run: cd npm && npm ci
  #    - name: build js bundle
  #      run: cd npm && npm run build
  #    - name: copy js bundle
  #      run: cd npm/build/ && cp sgGeocode_bundle.js ../../nuget/SmartyStreetsGoogleGeocode

  release:
    name: test and publish
    runs-on: windows-latest

    steps:
      - uses: actions/checkout@v2
      - name: Setup .NET Core
        uses: actions/setup-dotnet@v1
        with:
          dotnet-version: 3.1.301
      - name: Build solution
        run: |
          cd nuget/SmartyStreetsGoogleGeocode
          dotnet build --configuration release
      - name: Test
        run: |
          echo "::set-env name=SmartyStreets_AuthId::${{secrets.SMARTYSTREETS_AUTHID}}"
          echo "::set-env name=SmartyStreets_AuthToken::${{secrets.SMARTYSTREETS_AUTHTOKEN}}"
          echo "::set-env name=Google_Api_Key::${{secrets.GOOGLE_API_KEY}}"
          cd nuget/SmartyStreetsGoogleGeocode
          dotnet test
      #- name: Create NuGet package
      #  run: |
      #    cd nuget/SmartyStreetsGoogleGeocode
      #    dotnet pack -c Release /p:Version=${{ github.event.release.tag_name }}
      #- name: Push with dotnet
      #  run: |
      #    cd nuget/SmartyStreetsGoogleGeocode
      #    dotnet nuget push **/*.nupkg --api-key ${{ secrets.NUGET_API_KEY }} --source https://api.nuget.org/v3/index.json
